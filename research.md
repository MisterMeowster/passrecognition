Распознавание и разметка данных паспорта.

Цель распознавания и разметки паспортных данных можно разделить на несколько задач:

1. Поиск датасета.

Публикация паспортных данных в сети невозможна, поэтому были созданы искусственно сгенерированные датасеты и инструменты для генерации собственных датасетов с документами:

Датасеты семейства MIDV. Это датасеты от Smart Engine, содержащие видеоклипы, сканы и фотографии документов разных стран. Например, MIDV-2020 содержит 1000 видеоклипов, 2000 сканов и 1000 фотографий документов, для каждого из которых есть полная разметка (ftp://smartengines.com/midv-2020)

Датасеты из Kaggle или HuggingFace.

Датасеты, сгенерированные самостоятельно с помощью инструментов типа fake

2. Предобработка изображения.

Есть ряд методов предобработки изображений, которые облегчают алгоритму задачу вычленения текста. Это обязательные методы, которые нужны для дальнейшего верного распознавания. Выполняются по очереди:

Grayscale – перевод изображения из цветного формата в оттенки серого.

Denoising – удаление шума с помощью фильтров по типу медианного. Можно еще использовать связку адаптивной бинаризации + удаление мелких объектов, но тогда можно потерять буквы с маленьким шрифтом. С учетом работы со сканами, лучше применить медианный фильтр или не применять ничего, если работа идет с качественными сканами.

Thresholding – пороговая обработка для отделения текста от фона. При работе со сканами с равномерной яркостью можно применить метод Оцу.

«Выпрямление документа» - поворот документа по главной оси. Есть отдельная библиотека deskew.

3. Примените OCR для извлечения текста.

Среди методов OCR есть процедурные и нейросетевые методы.

К процедурному методу относится Tesseract OCR (pytesseract). Быстрый и простой метод, но плохо работает с шумными изображениями или фотографиями документов, сделанных под сильным углом.

К нейросетевым методам относятся: EasyOCR, TrOCR, Donut, PaddleOCR. Отличаются по скорости работы, точности, поддерживаемым языкам. Например, Donut умеет распознавать форму документа, но обучен только на английском, а TrOCR очень точный, но медленный.

Так как в тестовом задании используются сгенерированные сканы, то pytesseract выглядит наиболее приемлемым методом.

4. Анализ текста

По тестовому заданию необходимо выделить:

1. Фотография владельца.

Можно найти с помощью нейросетевых методов (например. SAM, MTCNN, RetinaFace, BlazeFace) или процедурными с помощью библиотек OpenCV и Dlib.

2.ФИО, пол, дата рождения, место рождения, серия и номер паспорта. Можно найти по контексту и структуре данных. Также есть нейросетевые методы:  DeepPavlov/ner-bert, slav-nlp/rus-ner-rubert, ai-forever/ruBERT, Davlan/bert-base-multilingual-cased-ner-hrl, dslim/bert-base-NER, bert-base-cased, flair/ner-english

5. Разметка на изображении.

После анализа извлеченного текста можно составить аннотации к bounding box.

В этом случае мною был выбран небольшой датасет, состоящий из тех изображений, которые были высланы мне в качестве части тестового задания, и дополнительных искусственно сгенерированных изображений, взятых из интернета. В качестве OCR я выбрал pytesseract с последующим  поиском фотографии с помощью Dlib и анализом текстовой информации с помощью формы паспорта. То есть, поиск имени справа от слова «имя» и так далее. Координаты слов определяются на этапе OCR.

Примененный метод

Если структура паспорта всегда одинакова, то можно вычислить местоположение тех или иных данных через структуру. Тогда алгоритм будет выглядеть следующим образом:

1. Изменение размера изображения.

2. Grayscaling

3. Фильтр нижних частот

4. Повышение четкости

5. Thresholding

6. «Выпрямление документа»

7. Извлечение текста с помощью OCR

8. Анализ текста через структуру документа, структуру интересующего фрагмента и распознавание сущностей с помощью библиотеки natasha